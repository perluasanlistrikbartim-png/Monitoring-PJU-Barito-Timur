<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TINJU ‚Äì Monitoring PJU Barito Timur</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<style>
body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 0; padding: 0; }
h2 { background: #1976d2; color: #fff; padding: 10px; text-align: center; }
form { background: #fff; margin: 20px auto; max-width: 480px; padding: 20px;
       border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
label { display: block; font-weight: bold; margin-top: 10px; }
input, select, textarea {
  width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px;
}
button {
  width: 100%; background: #1976d2; color: white; border: none; padding: 10px;
  border-radius: 6px; font-weight: bold; margin-top: 10px; cursor: pointer;
}
button:hover { background: #0d47a1; }
#map { height: 300px; margin-top: 10px; border-radius: 6px; }
#msg { text-align: center; font-weight: bold; margin-top: 10px; }
</style>
</head>

<body>
<h2>üìã Monitoring PJU (TINJU) ‚Äì Kabupaten Barito Timur</h2>

<form action="https://script.google.com/macros/s/AKfycbwcMi_pBDlXeEzS5wxpIuiRmDjvkiwjgR53TmcfhGyi0DcKTSj3sgGXxfmPEpbVhUgg4g/exec" 
      method="POST" target="hidden_iframe" onsubmit="return kirim();">

  <label>Tanggal Pemeriksaan:</label>
  <input type="date" name="tanggal" required>

  <label>Nama Petugas:</label>
  <input type="text" name="petugas" required placeholder="Nama lengkap">

  <label>Nama Lokasi / Panel PJU:</label>
  <input type="text" name="lokasi" required placeholder="Contoh: Panel PJU Pasar Tamiang Layang">

  <label>Koordinat Lokasi:</label>
  <input type="text" name="koordinat" id="koordinat" readonly required>
  <div id="map"></div>
  <button type="button" id="lokasiSaya">üìç Ambil Lokasi Saya</button>

  <label>Jenis Kerusakan:</label>
  <select name="jenis" required>
    <option value="">Pilih Jenis Kerusakan</option>
    <option value="Lampu">Lampu</option>
    <option value="Jaringan Kabel">Jaringan Kabel</option>
    <option value="Alat Proteksi & Kontroller">Alat Proteksi & Kontroller</option>
    <option value="Short Circuit">Short Circuit</option>
    <option value="Hilang Tegangan Sebelum KWh Meter">Hilang Tegangan Sebelum KWh Meter</option>
    <option value="Tidak Diketahui Kerusakannya">Tidak Diketahui Kerusakannya</option>
  </select>

  <label>Keterangan:</label>
  <textarea name="keterangan" rows="3"></textarea>

  <button type="submit">‚úÖ Kirim Data</button>
</form>

<iframe name="hidden_iframe" style="display:none;"></iframe>
<div id="msg"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
function kirim(){
  document.getElementById('msg').textContent = "‚úÖ Data berhasil dikirim! Periksa Google Sheet anda.";
  return true;
}

window.onload = () => {
  const map = L.map('map').setView([-2.13, 115.10], 9);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
  let marker;

  map.on('click', e => {
    const lat = e.latlng.lat.toFixed(6);
    const lng = e.latlng.lng.toFixed(6);
    document.getElementById('koordinat').value = `${lat}, ${lng}`;
    if (marker) map.removeLayer(marker);
    marker = L.marker(e.latlng).addTo(map).bindPopup(`üìç ${lat}, ${lng}`).openPopup();
  });

  document.getElementById('lokasiSaya').addEventListener('click', () => {
    if (!navigator.geolocation) return alert("Browser tidak mendukung GPS.");
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude.toFixed(6);
      const lng = pos.coords.longitude.toFixed(6);
      document.getElementById('koordinat').value = `${lat}, ${lng}`;
      map.setView([lat, lng], 17);
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lng]).addTo(map)
        .bindPopup(`üìç Lokasi Anda<br>${lat}, ${lng}`).openPopup();
    }, () => alert("Gagal mengambil lokasi. Pastikan GPS aktif."));
  });
};
</script>
</body>
</html>
